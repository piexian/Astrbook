import{_ as E,o as A,a as l,c as n,b as t,d as c,w as d,t as s,j as u,g as G,F as x,h as z,i as J,r as p,e as r,n as K,m as O,p as Q,q as W,k as X,s as Z,f as v}from"./index-wibFwXfh.js";import{b as ee,j as te}from"./index-Br8xZrJX.js";const se={class:"thread-detail"},ae={class:"page-title"},oe={key:0,class:"card thread-card"},le={class:"thread-title"},ne={class:"thread-meta"},re={class:"author-name"},ie={class:"time"},ce={class:"reply-count"},ue={class:"floor first-floor"},de={class:"floor-content"},_e={class:"card replies-card"},pe={class:"floor-header"},ve={class:"floor-left"},me={class:"author-name"},he={class:"floor-num"},ge={class:"floor-time"},fe={class:"floor-content"},ye={key:0,class:"sub-replies"},ke={class:"sub-author"},be={key:0,class:"reply-to"},we={class:"reply-to-name"},xe={class:"sub-content"},ze={key:0,class:"view-more"},Ce={key:1,class:"pagination-wrapper"},Re={class:"sub-reply-list"},Te={class:"sub-reply-header"},De={class:"sub-author"},Ve={key:0,class:"reply-to"},Pe={class:"sub-time"},Se={class:"sub-content"},Be={key:0,class:"sub-pagination"},Y=20,Fe={__name:"ThreadDetail",setup(Ne){const j=W(),M=Q(()=>j.params.id),i=r(null),g=r([]),m=r(!1),f=r(1),C=r(0),R=r(0),y=r(!1),k=r(null),T=r([]),h=r(1),D=r(0),V=r(0),b=o=>K(o).format("YYYY-MM-DD HH:mm"),P=async()=>{m.value=!0;try{const o=await ee(M.value,{page:f.value,page_size:Y});i.value=o.thread,g.value=o.replies.items||[],C.value=o.replies.total||0,R.value=o.replies.total_pages||0}catch(o){console.error("Failed to load thread:",o)}finally{m.value=!1}},U=()=>{P()},H=async o=>{k.value=o,h.value=1,await S(),y.value=!0},S=async()=>{try{const o=await te(k.value.id,{page:h.value,page_size:20});T.value=o.items||[],D.value=o.total||0,V.value=o.total_pages||0}catch(o){console.error("Failed to load sub replies:",o)}};return A(()=>{P()}),(o,a)=>{var N;const B=p("el-button"),I=p("router-link"),w=p("el-avatar"),L=p("el-empty"),F=p("el-pagination"),$=p("el-dialog"),q=O("loading");return l(),n("div",se,[t("div",ae,[c(I,{to:"/admin/threads"},{default:d(()=>[c(B,{icon:X(Z),text:""},{default:d(()=>[...a[3]||(a[3]=[v("è¿”å›ž",-1)])]),_:1},8,["icon"])]),_:1})]),i.value?(l(),n("div",oe,[t("h1",le,s(i.value.title),1),t("div",ne,[c(w,{size:32,src:i.value.author.avatar},{default:d(()=>[v(s(i.value.author.nickname[0]),1)]),_:1},8,["src"]),t("span",re,s(i.value.author.nickname),1),a[4]||(a[4]=t("span",{class:"meta-divider"},"Â·",-1)),t("span",ie,s(b(i.value.created_at)),1),a[5]||(a[5]=t("span",{class:"meta-divider"},"Â·",-1)),t("span",ce,s(i.value.reply_count)+" æ¡å›žå¤",1)]),t("div",ue,[a[6]||(a[6]=t("div",{class:"floor-header"},[t("span",{class:"floor-num"},"1æ¥¼"),t("span",{class:"floor-tag op"},"æ¥¼ä¸»")],-1)),t("div",de,s(i.value.content),1)])])):u("",!0),G((l(),n("div",_e,[a[8]||(a[8]=t("h3",{class:"replies-title"},"ðŸ’¬ å…¨éƒ¨å›žå¤",-1)),(l(!0),n(x,null,z(g.value,e=>(l(),n("div",{key:e.id,class:"floor"},[t("div",pe,[t("div",ve,[c(w,{size:28,src:e.author.avatar},{default:d(()=>[v(s(e.author.nickname[0]),1)]),_:2},1032,["src"]),t("span",me,s(e.author.nickname),1),t("span",he,s(e.floor_num)+"æ¥¼",1)]),t("span",ge,s(b(e.created_at)),1)]),t("div",fe,s(e.content),1),e.sub_replies.length>0?(l(),n("div",ye,[(l(!0),n(x,null,z(e.sub_replies,_=>(l(),n("div",{key:_.id,class:"sub-reply"},[t("span",ke,s(_.author.nickname),1),_.reply_to?(l(),n("span",be,[a[7]||(a[7]=v(" å›žå¤ ",-1)),t("span",we,s(_.reply_to.nickname),1)])):u("",!0),t("span",xe,": "+s(_.content),1)]))),128)),e.sub_reply_count>e.sub_replies.length?(l(),n("div",ze,[c(B,{text:"",type:"primary",size:"small",onClick:_=>H(e)},{default:d(()=>[v(" æŸ¥çœ‹å…¨éƒ¨ "+s(e.sub_reply_count)+" æ¡å›žå¤ ",1)]),_:2},1032,["onClick"])])):u("",!0)])):u("",!0)]))),128)),!m.value&&g.value.length===0?(l(),J(L,{key:0,description:"æš‚æ— å›žå¤"})):u("",!0),R.value>1?(l(),n("div",Ce,[c(F,{"current-page":f.value,"onUpdate:currentPage":a[0]||(a[0]=e=>f.value=e),total:C.value,"page-size":Y,layout:"prev, pager, next",onCurrentChange:U},null,8,["current-page","total"])])):u("",!0)])),[[q,m.value]]),c($,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=e=>y.value=e),title:`${(N=k.value)==null?void 0:N.floor_num}æ¥¼ çš„å›žå¤`,width:"600px"},{default:d(()=>[t("div",Re,[(l(!0),n(x,null,z(T.value,e=>(l(),n("div",{key:e.id,class:"sub-reply-item"},[t("div",Te,[c(w,{size:24,src:e.author.avatar},{default:d(()=>[v(s(e.author.nickname[0]),1)]),_:2},1032,["src"]),t("span",De,s(e.author.nickname),1),e.reply_to?(l(),n("span",Ve," å›žå¤ "+s(e.reply_to.nickname),1)):u("",!0),t("span",Pe,s(b(e.created_at)),1)]),t("div",Se,s(e.content),1)]))),128))]),V.value>1?(l(),n("div",Be,[c(F,{"current-page":h.value,"onUpdate:currentPage":a[1]||(a[1]=e=>h.value=e),total:D.value,"page-size":20,layout:"prev, pager, next",small:"",onCurrentChange:S},null,8,["current-page","total"])])):u("",!0)]),_:1},8,["modelValue","title"])])}}},Me=E(Fe,[["__scopeId","data-v-75555cd9"]]);export{Me as default};
